{
  "services": [
    {
      "name": "nextcloud-db",
      "image": "mariadb:11",
      "environment": {
        "MYSQL_ROOT_PASSWORD": "rootpassword",
        "MYSQL_PASSWORD": "tipi",
        "MYSQL_DATABASE": "database",
        "MYSQL_USER": "tipi"
      },
      "volumes": [
        {
          "hostPath": "${APP_DATA_DIR}/data/db",
          "containerPath": "/var/lib/mysql",
          "readOnly": false,
          "shared": false,
          "private": false
        }
      ],
      "healthcheck": {
        "test": ["CMD", "mysqladmin", "ping", "-h", "localhost", "-prootpassword"],
        "interval": 10000000000,
        "timeout": 5000000000,
        "retries": 5,
        "startPeriod": 10000000000
      }
    },
    {
      "name": "nextcloud",
      "image": "nextcloud",
      "environment": {
        "MYSQL_PASSWORD": "tipi",
        "MYSQL_DATABASE": "database",
        "MYSQL_USER": "tipi",
        "MYSQL_HOST": "nextcloud-db",
        "NEXTCLOUD_ADMIN_USER": "${NEXTCLOUD_ADMIN_USER}",
        "NEXTCLOUD_ADMIN_PASSWORD": "${NEXTCLOUD_ADMIN_PASSWORD}"
      },
      "internalPort": 80,
      "volumes": [
        {
          "hostPath": "${APP_DATA_DIR}/data/nextcloud",
          "containerPath": "/var/www/html",
          "readOnly": false,
          "shared": false,
          "private": false
        }
      ],
      "depends_on": {
        "nextcloud-db": {
          "condition": "service_healthy"
        }
      },
      "extraLabels": {
        "traefik.http.middlewares.nextcloud.headers.browserXSSFilter": "true",
        "traefik.http.middlewares.nextcloud.headers.contentTypeNosniff": "true",
        "traefik.http.middlewares.nextcloud.headers.stsIncludeSubdomains": "true",
        "traefik.http.middlewares.nextcloud.headers.stsPreload": "true",
        "traefik.http.middlewares.nextcloud.headers.stsSeconds": "155520011",
        "traefik.http.middlewares.nextcloud_redirect.redirectregex.permanent": "true",
        "traefik.http.middlewares.nextcloud_redirect.redirectregex.regex": "https://(.*)/.well-known/(card|cal)dav",
        "traefik.http.middlewares.nextcloud_redirect.redirectregex.replacement": "https://$${1}/remote.php/dav/",
        "traefik.http.routers.nextcloud.middlewares": "nextcloud,nextcloud_redirect,nextcloud-https",
        "traefik.http.middlewares.nextcloud.headers.customRequestHeaders.X-Forwarded-Proto": "https",
        "traefik.http.middlewares.nextcloud-https.redirectscheme.scheme": "https",
        "traefik.http.routers.nextcloud-http.middlewares": "nextcloud-https@docker"
      }
    }
  ]
}
