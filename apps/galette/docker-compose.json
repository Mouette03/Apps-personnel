{
  "services": [
    {
      "name": "galette-db",
      "image": "mariadb:10.5",
      "environment": {
        "MYSQL_ROOT_PASSWORD": "rootpass",
        "MYSQL_DATABASE": "galettedb",
        "MYSQL_USER": "galetteuser",
        "MYSQL_PASSWORD": "galettepwd"
      },
      "volumes": [
        {
          "hostPath": "${APP_DATA_DIR}/galette_db",
          "containerPath": "/var/lib/mysql",
          "readOnly": false,
          "shared": false,
          "private": false
        }
      ]
    },
    {
      "name": "galette",
      "image": "galette/galette:1.1.5.2",
      "environment": {
        "DB_TYPE": "mysqli",
        "DB_HOST": "mariadb",
        "DB_NAME": "galettedb",
        "DB_USER": "galetteuser",
        "DB_PASS": "galettepwd"
      },
      "internalPort": 80,
      "command": "sh -c 'chown -R www-data:www-data /var/www/galette/data /var/www/galette/config && apache2-foreground'",
      "volumes": [
        {
          "hostPath": "${APP_DATA_DIR}/galette_config",
          "containerPath": "/var/www/galette/config",
        },
        {
          "hostPath": "${APP_DATA_DIR}/galette_attachments",
          "containerPath": "/var/www/galette/data/attachments",
        },
        {
          "hostPath": "${APP_DATA_DIR}/galette_cache",
          "containerPath": "/var/www/galette/data/cache",
        },
        {
          "hostPath": "${APP_DATA_DIR}/galette_files",
          "containerPath": "/var/www/galette/data/files",
        },
        {
          "hostPath": "${APP_DATA_DIR}/galette_logs",
          "containerPath": "/var/www/galette/data/logs",
        },
        {
          "hostPath": "${APP_DATA_DIR}/galette_photos",
          "containerPath": "/var/www/galette/data/photos",
        },
        {
          "hostPath": "${APP_DATA_DIR}/galette_templates",
          "containerPath": "/var/www/galette/data/templates_c",
        }
      ],
      "dependsOn": {
        "galette-db": {
          "condition": "service_started"
        }
      },
      "isMain": true
    }
  ]
}